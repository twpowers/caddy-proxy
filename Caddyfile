:{$PORT:8080} {
    # Health check endpoint
    handle /health {
        respond "OK" 200
    }
    
    # API route - proxy to API_URL
    handle_path /api/* {
        reverse_proxy {$API_URL} {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
    
    # Main route - proxy to MAIN_URL (everything else)
    handle {
        reverse_proxy {$MAIN_URL} {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
}
